---
title: 도서 대출 시스템에 ElasticSearch 도입으로 검색 품질 높이기
description: RDB 기반 LIKE 검색의 한계를 ES로 개선한 과정과 결과, 그리고 도입 시 주의점을 정리한 글
---

# 도서 대출 시스템에 ElasticSearch 도입으로 검색 품질 높이기
## 주제 선정 이유
> 선정 이유는 도서 대출 시스템의 **검색 기능**을 개발하던 중, 대규모 데이터에서 **검색 속도와 품질** 문제를 해결하기 위한 방법을 찾기 위해서 입니다.
 


## 목차
1. [주제 및 선정 배경](#1-주제-및-선정-배경)
2. [기존 검색 시스템의 문제점](#2-기존-검색-시스템의-문제점)
3. [ElasticSearch 소개](#3-elasticsearch-소개)
4. [ES 도입 및 효과](#4-es-도입-및-효과)
5. [도입 시 주의할 점과 마무리](#5-도입-시-주의할-점과-마무리)

---

## 1. 주제 및 선정 배경

도서 대출 시스템의 검색 기능을 구현하면서 다음과 같은 문제를 겪었습니다.

- `LIKE '%키워드%'` 기반 검색이 데이터가 커질수록 **현저히 느림**
- **부분 검색**, **자동완성**, **오타 허용**, **연관도 정렬** 같은 UX 요구사항을 RDB만으로 충족하기 어려움
- 인덱스(B-Tree)·Full-Text Index를 적용해도 **토큰 길이·패턴 제약**으로 실사용 품질이 떨어짐

이러한 이유로 **ElasticSearch(ES)** 도입을 검토했고, 실제로 적용하여 성능과 품질을 개선했습니다. 이 문서는 그 과정과 결과, 그리고 운영 관점에서의 주의점을 정리한 것입니다.

---

## 2. 기존 검색 시스템의 문제점

### 2.1 LIKE 검색의 구조적 한계
```sql
SELECT [필드명]
FROM [테이블명]
WHERE [필드명] LIKE '%특정 문자열%';
```
- `'%키워드%'`는 **인덱스 시작점이 없어** 풀스캔으로 이어짐
- 가능한 패턴은 `LIKE '키워드%'` 정도이나, 이 경우 **검색 사용성**이 크게 떨어짐

### 2.2 성능 및 시스템 영향
- **100만 건**: 약 **5.3초** / **900만 건**: 약 **10초** 수준으로 지연
- 풀스캔으로 **디스크 I/O 증가 → 응답 지연 → 전체 성능 저하**

### 2.3 Full-Text Index의 보완과 한계
- 속도는 일부 개선되지만, **토큰 최소 길이(기본 3)** 제약으로 “자바(2글자)” 등 누락 발생
- 최소 길이를 2로 낮추면 **인덱스 급팽창**
- 여전히 `'%키워드%'` **부분 검색 불가**

---

## 3. ElasticSearch 소개

- **루씬(Lucene)** 기반 오픈소스 검색 엔진
- 문서를 **JSON**으로 **색인**하고 역인덱스 구조를 활용해 **빠르게 검색**
- 주요 특징
  - **준 실시간 검색**: 색인 후 짧은 지연 뒤 바로 검색 가능
  - **분산 아키텍처**: 노드 수평 확장, 고가용성
  - **REST API**: 언어 불문 연동 용이
  - **한국어 형태소 분석(Nori)**, **자동완성**, **오타 허용**, **연관도 정렬(BM25)** 등

---

## 4. ES 도입 및 효과

### 4.1 적용 개요
- 인덱스 설계: 책 문서의 제목/저자/카테고리 등을 **text + keyword** 조합으로 매핑
- 한국어 분석기: **Nori Tokenizer** 적용
- 자동완성: **Completion Suggester** 또는 **Edge N-gram** 중 요구사항에 맞춰 선택
- 연관도: 기본 **BM25**

### 4.2 성능 개선(체감)
- **100만 건**: 약 **5.3초 → 22ms**
- **900만 건**: 약 **10초 → 23ms**
- 데이터가 9배 증가해도 **체감 속도 동일**, 검색 UX 대폭 개선

### 4.3 검색 품질 개선
- **부분 검색** 가능(토큰화와 쿼리 설계 조합)
- **오타 허용**(fuzziness)으로 잘못 입력해도 의도한 결과 도달
- **자동완성**으로 빠른 탐색 유도
- **연관도 정렬(BM25)** 로 의미 있는 결과가 상단 배치

### 4.4 예시 스니펫
```json
GET _analyze
{
  "tokenizer": "nori_tokenizer",
  "text": ["혼자 공부하는 운영체제와 컴퓨터 구조"]
}
```

```json
POST books/_search
{
  "suggest": {
    "title_suggest": {
      "prefix": "자바",
      "completion": {
        "field": "title_suggest",
        "size": 5
      }
    }
  }
}
```

---

## 5. 도입 시 주의할 점과 마무리

### 5.1 운영 관점 유의사항
- **완전 실시간이 아님**: 색인 직후 검색까지 약간의 지연 발생(commit/refresh)
- **트랜잭션 롤백 미지원**: 배치·작업 설계 시 주의
- **부분 업데이트 없음**: 내부적으로 삭제 후 재색인
- **매핑 변경 불가**: 필드 구조 변경 시 새 인덱스 필요 → 초기 **스키마 설계** 중요
- **동적 매핑 과신 금지**: 값 범위/정밀도 고려해 **정적 매핑 병행**
- **샤드/레플리카 설계**: 성능·메모리·장애 복구에 영향 → 트래픽·데이터량 기준으로 설정

### 5.2 결론
- **RDB**는 **정확·일관 저장**에, **ES**는 **대용량 고품질 검색**에 강점
- 라이브러리(도서 대출) 시스템처럼 검색 품질이 중요한 서비스에서는 **ES 도입을 우선 검토**하는 것이 합리적

---

## 참고:
- inflearn - elasticsearch essential
- 엘라스틱서치 바이블
